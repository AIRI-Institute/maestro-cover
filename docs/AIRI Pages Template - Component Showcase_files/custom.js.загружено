document.addEventListener('DOMContentLoaded', function(){
    // Показ/скрытие меню в зависимости от позиции header и footer
    const pageNavbar = document.getElementById('page-navbar');
    if (pageNavbar) {
        // Добавляем transition для плавного появления/скрытия
        pageNavbar.style.transition = 'opacity 0.3s ease, transform 0.3s ease';

        window.addEventListener('scroll', function() {
            const header = document.getElementById('page-header');
            const footer = document.getElementById('page-footer');

            if (header && footer) {
                const headerRect = header.getBoundingClientRect();
                const footerRect = footer.getBoundingClientRect();

                // Проверяем, виден ли header
                const headerVisible = headerRect.bottom > 0;

                // Проверяем, виден ли footer
                const footerVisible = footerRect.top < window.innerHeight;

                if (!headerVisible && !footerVisible) {
                    // Header не виден и footer не виден - показываем меню
                    pageNavbar.style.opacity = '1';
                    pageNavbar.style.visibility = 'visible';
                    pageNavbar.style.transform = 'translateY(0)';
                } else if (footerVisible) {
                    // Footer виден - плавно скрываем меню
                    const overlap = window.innerHeight - footerRect.top;
                    pageNavbar.style.transform = `translateY(-${overlap + 20}px)`;
                    pageNavbar.style.opacity = '0';
                } else {
                    // Header виден - скрываем меню
                    pageNavbar.style.opacity = '0';
                    pageNavbar.style.transform = `translateY(-${overlap + 20}px)`;
                    pageNavbar.style.visibility = 'hidden';
                }
            }
        });

        // Запускаем проверку при загрузке
        window.dispatchEvent(new Event('scroll'));
    }

    // Initialize Fancybox for Lightbox
    Fancybox.bind('[data-fancybox]', {
        // Custom options
    });

    // Initialize Cocoen for Before/After
    Cocoen.parse(document.body);

    // ===== Swiper with Navigation =====
    new Swiper('#swiper-navigation', {
        loop: true,
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
        },
    });

    // ===== Swiper with Pagination =====
    new Swiper('#swiper-pagination', {
        loop: true,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
    });

    // ===== Swiper with Autoplay =====
    new Swiper('#swiper-autoplay', {
        loop: true,
        autoplay: {
            delay: 3000,
            disableOnInteraction: false,
        },
        pagination: {
            el: '.swiper-pagination',
        },
    });

    // ===== Chart.js - Bar Chart =====
    new Chart(document.getElementById('bar-chart'), {
        type: 'bar',
        data: {
            labels: ['CCP (ours)', 'Max Prob.', 'Perplexity', 'Token Entropy'],
            datasets: [
                {
                    label: 'Chinese',
                    data: [0.64, 0.52, 0.51, 0.51],
                    backgroundColor: '#2ebead',
                },
                {
                    label: 'Arabic',
                    data: [0.66, 0.59, 0.56, 0.56],
                    backgroundColor: '#64bbf3',
                },
                {
                    label: 'Russian',
                    data: [0.68, 0.63, 0.58, 0.58],
                    backgroundColor: '#53d98a',
                },
            ],
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'ROC-AUC Comparison by Method',
                },
                legend: {
                    position: 'top',
                },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1,
                },
            },
        },
    });

    // ===== Chart.js - Line Chart =====
    new Chart(document.getElementById('line-chart'), {
        type: 'line',
        data: {
            labels: ['Epoch 1', 'Epoch 2', 'Epoch 3', 'Epoch 4', 'Epoch 5', 'Epoch 6'],
            datasets: [
                {
                    label: 'Training Accuracy',
                    data: [0.65, 0.72, 0.78, 0.83, 0.87, 0.89],
                    borderColor: '#2ebead',
                    backgroundColor: 'rgba(46, 190, 173, 0.1)',
                    tension: 0.4,
                },
                {
                    label: 'Validation Accuracy',
                    data: [0.62, 0.69, 0.74, 0.79, 0.82, 0.84],
                    borderColor: '#64bbf3',
                    backgroundColor: 'rgba(100, 187, 243, 0.1)',
                    tension: 0.4,
                },
            ],
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Training Progress',
                },
                legend: {
                    position: 'top',
                },
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1,
                },
            },
        },
    });

    // ===== Chart.js - Pie Chart =====
    new Chart(document.getElementById('pie-chart'), {
        type: 'pie',
        data: {
            labels: ['Correct', 'Incorrect', 'Uncertain'],
            datasets: [
                {
                    data: [65, 20, 15],
                    backgroundColor: ['#53d98a', '#e6434e', '#fef3e3'],
                },
            ],
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                },
            },
        },
    });

    // ===== Chart.js - Doughnut Chart =====
    new Chart(document.getElementById('doughnut-chart'), {
        type: 'doughnut',
        data: {
            labels: ['English', 'Chinese', 'Arabic', 'Russian'],
            datasets: [
                {
                    data: [30, 40, 20, 10],
                    backgroundColor: ['#2ebead', '#64bbf3', '#53d98a', '#fecc4e'],
                },
            ],
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                },
            },
        },
    });

    // ===== Copy Code Functionality =====
    document.querySelectorAll('.copy-code-btn').forEach((button) => {
        button.addEventListener('click', function () {
            const targetId = this.getAttribute('data-copy-target');
            const codeElement = document.getElementById(targetId);
            const textToCopy = codeElement.textContent;

            navigator.clipboard.writeText(textToCopy).then(() => {
                const originalHTML = this.innerHTML;
                this.innerHTML = '<i data-lucide="check" style="width: 14px; height: 14px;"></i> Скопировано!';
                lucide.createIcons();

                setTimeout(() => {
                    this.innerHTML = originalHTML;
                    lucide.createIcons();
                }, 2000);
            });
        });
    });
})